---
title: 地图追踪
order: 20
---

::: warning 注意

只支持最大的地表地图，不支持地底识别，也不支持渊下宫、层岩巨渊地底地图。

在特征不明显的地区表现很差，无法正确识别出位置，比如沙漠、风起地等。

地图追踪支持大于等于 `1920x1080` 的 `16:9` 分辨率，太小的分辨率无法识别清小地图。

原神设置中的“小地图锁定”，必须是“锁定方向”。

**地图追踪在截图方式 `WindowsGraphicsCapture` 下表现很差，请使用 `BitBlt` ！**

:::

✨ 路径追踪的核心功能参考自 [minimap](https://github.com/tignioj/minimap)
项目，[minimap](https://github.com/tignioj/minimap) 是一个完成度非常高原神自动采集工具，当然它的功能远不止这些，强烈推荐！

## 执行路径追踪任务

路径追踪任务会自动传送到最近的锚点，然后根据小地图开始寻路。系统会根据任务文件的途径点和目标点进行导航。路径追踪任务文件存储在 `\User\AutoPathing`
目录下。

在使用过程中，推荐使用 `1920x1080` 的分辨率，以保证图像识别的准确性。

执行前点击“查看实时追踪地图”，可以看到实时的地图识别情况。

### 使用调度器执行

这边建议所有的路径追踪任务，都放入调度器中执行，只有调度器能够批量执行任务！

由于自动采集之类的操作，是有一定周期性的，未来肯定都是会经过调度器来进行运行的。

### 路径追踪配置

![](https://img.alicdn.com/imgextra/i1/2042484851/O1CN01s8fjNc1lhoK0y34fD_!!2042484851.png)

角色设置没有特殊的角色需要开E释放护盾、回血的需求的情况下，无需修改。

队伍切换设置就是按优先级自动根据条件在游戏内切换队伍，也就是不同的路线（含有不同的动作、采集物）会自动按照条件切换队伍。*
*注意右侧的队伍名称要和游戏内的队伍名称一致。**

![](https://img.alicdn.com/imgextra/i2/2042484851/O1CN01I1vTaA1lhoJzH9Cqf_!!2042484851.png)

在调度器配置组中存在类似的配置，但是不是条件形式，而是强制指定形式，自由度更高，但是至针对调度器配置组生效，且会覆盖路径追踪的默认配置。

#### 一些比较适合采集的角色选择

* E盾：莱依拉、绮良良、钟离（可能会爬柱子）
* 前台持续回血：芭芭拉（满命复活）、七七
* 后台回血：生命值低于40%时，**迪希雅**将基于生命值上限的20%恢复生命值，并在接下来的10秒内，每2秒基于生命值上限的6%为迪希雅恢复生命值。该效果每20秒至多触发一次。
* 采集回血：**白术**处于队伍中时，与部分采集物交互能够为队伍中自己的当前场上角色恢复生命值，回复量基于白术生命值上限的2.5%。

## 制作路径追踪任务

所有结果文件都保存在 `\User\AutoPathing` 目录下（无论是编辑器中导出还是不使用编辑器的情况下）。BetterGI界面内只会显示其中二级目录下的文件。

首先在录制前点击“打开录制编辑器”，然后去快捷键标签页绑定下面的快捷键，然后在游戏内使用。

1. **启动/停止路径记录器**：启动或停止记录过程。（未打开录制编辑器的情况下会直接保存文件）
2. **添加路径点**：在路径中添加一个记录点。具体记录点类型和一些配置需要手动修改。

录制完成后可以在编辑器中修改点位的各个属性，然后导出路径即可。

注意：

- 这个功能实际不会录制你的路径，只是在你按下快捷键时记录当前所在点位，你可以直接在录制编辑器中编辑，也可以手动修改点位文件。
-

如果要完成一个“下落攻击退出飞行状态”的动作，请在空中记录一次路径点，并在下落攻击落地后再记录一个路径点。并且修改空中点位的 `action` 。

- 请不要过于频繁地录制路径点（每个路径点不要太近），相距较远的路径点会使用疾跑等方式快速接近并不断修正误差，频繁录制将导致视角震荡等问题。
- 🗺️ 录制编辑器也提供了在线版：[https://bgi-map.huiyadan.com/](https://bgi-map.huiyadan.com/)

## 路径追踪文件格式

文件示例：

```json
{
  "info": {
    "name": "示例名称",
    "type": "collect"
  },
  "positions": [
    {
      "action": "",
      "move_mode": "walk",
      "type": "teleport",
      "x": 3397.591796875001,
      "y": -1174.529296875
    },
    {
      "action": "",
      "move_mode": "fly",
      "type": "path",
      "x": 3376.546386718751,
      "y": -1133.45263671875
    },
    {
      "action": "stop_flying",
      "move_mode": "fly",
      "type": "path",
      "x": 3366.349609375001,
      "y": -1111.7900390625
    },
    {
      "action": "",
      "move_mode": "walk",
      "type": "target",
      "x": 3346.599609375001,
      "y": -1085.44873046875
    }
  ]
}
```

解释：

- `info` 对象包含了基础信息（当前除了展示没啥用）

| 字段名      | 描述   | 详细信息                          |
|----------|------|-------------------------------|
| `name`   | 名称   | 建议和文件名一致                      |
| `type`   | 路径类型 | 当前此字段除了展示无作用 <br>`collect`：采集 |
| `author` | 作者   | 作者信息                          |

- `positions` 数组包含了一系列的对象，每个对象代表一个游戏内位置和相关的动作信息。

| 字段名             | 描述   | 详细信息                                                                                     |
|-----------------|------|------------------------------------------------------------------------------------------|
| `x`             | X 坐标 | 原神游戏内坐标系下的X坐标                                                                            |
| `y`             | Y 坐标 | 原神游戏内坐标系下的Y坐标                                                                            |
| `type`          | 点位类型 | `teleport`：传送点，会触发自动传送操作 <br>`path`：途经点，粗略路过的点位 <br>`target`：目标点，精准经过的点位                 |
| `move_mode`     | 移动模式 | `walk`： 普通的行走模式，较远时会偶尔冲刺 <br> `fly`：不停的跳跃直到起飞 <br> `climb`：不会因为长时间在一个点导致触发自动避障（0.35.1新增） |
| `action`        | 动作   | 表示在该位置执行的动作，和移动相关的动作，都会在精确到达点位后执行。具体见下表                                                  |
| `action_params` | 动作参数 | 与动作配合使用，具体什么时候使用见下表                                                                      |

- `action` 可以有的值

| `action`值           | 描述                                                                                                                                                                  |
|---------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `stop_flying`       | 下落攻击，停止飞行，`move_mode = fly`的情况才有效。                                                                                                                                  |
| `force_tp`          | 强制以当前的x,y坐标进行自动传送，`type = teleport`的情况才有效。                                                                                                                          |
| `nahida_collect`    | 使用纳西妲长按E技能进行收集。                                                                                                                                                     |
| `pick_around`       | 在点位周围转圈移动，适合拾取等场景。`action_params` 可以填写数字，代表圈数，圈数越大拾取的范围也越大，不填默认为1                                                                                                                             |
| `hydro_collect`     | 使用水元素力收集(0.35.5存在)。[查看支持角色](https://github.com/babalae/better-genshin-impact/blob/main/BetterGenshinImpact/GameTask/AutoPathing/Handler/ElementalCollectHandler.cs) |
| `electro_collect`   | 使用雷元素力收集(0.35.5存在)。[查看支持角色](https://github.com/babalae/better-genshin-impact/blob/main/BetterGenshinImpact/GameTask/AutoPathing/Handler/ElementalCollectHandler.cs) |
| `anemo_collect`     | 使用风元素力收集(0.35.5存在)。[查看支持角色](https://github.com/babalae/better-genshin-impact/blob/main/BetterGenshinImpact/GameTask/AutoPathing/Handler/ElementalCollectHandler.cs) |
| `up_down_grab_leaf` | 上下移动视角按T前往四叶印(0.35.1存在)。                                                                                                                                            |
| `fight`             | 在此处直接执行自动战斗（0.36.4更新了结束方式）。                                                                                                                                         |
| `combat_script`     | 可以直接执行[战斗策略脚本](/feats/task/domain.html#战斗策略脚本编写)，策略脚本需要填写在 `action_params` 中。<br>当策略不指定角色名时，会直接使用当前角色执行策略脚本。<br>请注意活用战斗策略的特性：不存在队伍中的角色对应的策略也不会执行（0.36.4新增）。                       |

## 附录

全地图传送点坐标合集，也是软件内置的所有传送点，如果传送位置不对可以对照这个图看下

[https://wwmy.lanzouq.com/b0fosbd9g](https://wwmy.lanzouq.com/b0fosbd9g) 密码:coco
